{% extends 'public/dashboard/home_Admin.html' %}
{% block body %}

<div class="container-fluid">
    <div class="card shadow">
        <div class="card-body">

     <!-- Tabla -->
     <div style="overflow-x: auto;" >
        <table class="table table-bordered" style="font-size: 12px;">
            <thead>
                <tr>
                    <th class="col-1" style="width: 15%;">ID</th>
                    <th scope="col">Usuario</th>
                    <th scope="col">_____Dia_____</th>                            
                    <th scope="col">Viaje/OT</th>
                    <th scope="col">Cliente</th>
                    <th scope="col">Agencia</th>
                    <th scope="col">Tipo_Extra_Costo</th>
                    <th scope="col">_____Motivo_____</th>
                    <th scope="col">Hora_Llegada</th>
                    <th scope="col">_____Dia_____</th>
                    <th scope="col">Hora_Salida</th>
                    <th scope="col">_____Dia_____</th>
                    <th scope="col">Total Horas</th>
                    <th scope="col">Empresa</th>
                    <th scope="col">Responsable</th>
                    <th scope="col">Monto</th>
                    <th scope="col">Estado</th>
                    <th scope="col">Responsable Evaluacion</th>
                    <th scope="col">Archivo</th>
                    <th scope="col">Fecha Creacion</th>
                    <th scope="col">Fecha Cierre</th>
                    
                </tr>
            </thead>
    </div>
    
        <tbody>
            {% for d in data %}
                <tr>
                    <td>{{d.id}}</td>
                    <td>{{d.usuario}}</td>
                    <td>{{d.dia}}</td>
                    <td>{{d.viaje_ot}}</td>
                    <td>{{d.cliente}}</td>
                    <td>{{d.lugar}}</td>
                    <td>{{d.tipo_extra_costo}}</td>
                    <td>{{d.motivo}}</td>
                    <td>{{d.hora_llegada}}</td>
                    <td>{{d.dia2}}</td>
                    <td>{{d.hora_salida}}</td>
                    <td>{{d.dia3}}</td>
                    <td>{{d.total_horas}}</td>
                    <td>{{d.empresa}}</td>
                    <td>{{d.responsable}}</td>
                    <td>{{d.monto}}</td>
                    <td>{{d.estado}}</td>
                    <td>{{d.responsable_evaluacion}}</td>
                    <td><a href="{{ url_for('download', nombre_zip=d.nombre_zip) }}" class="btn btn-success btn-sm" title="Descargar" style="font-size: 8px;">Descargar</a></td>
                    <td>{{d.fecha_creacion}}</td>
                    <td>{{d.fecha_cierre}}</td>     
                    <!--Logica Para habilitar o desabilitar el boton de edicion dependiendo el perfil-->                                          
        
                </tr>

                <!-- modal -->

                <div class="modal fade" id="modal{{d.id}}" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                    <div class="modal-dialog">
                      <div class="modal-content">
                        <div class="modal-header">
                          <h1 class="modal-title fs-5" id="exampleModalLabel">{{d.username}}</h1>
                          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <form action="/edit/{{d.id}}" method="post">
                                
                                <label>Dia</label>
                                <input type="text" class="form-control mb-3" name="dia" value="{{d.dia}}" pattern="\d{2}-\d{2}-\d{4}" title="Ingrese una fecha válida en formato dd-mm-yyyy">

                                <label>Viaje/OT</label>
                                <input type="text" class="form-control mb-3" name="viaje_ot" value="{{d.viaje_ot}}">
            
                                                          

                                <label>Agencia</label>    
                                <select class="form-control mb-3" name="lugar">
                                    <option selected>-----</option>
                                    {% for lugar in ['IQQ', 'POZ', 'SCL', 'MCC'] %}
                                        <option value="{{ lugar }}" {% if d.lugar == lugar %} selected {% endif %}>{{ lugar }}</option>
                                    {% endfor %}
                                </select>


                                <label>Tipo Extra Costo</label>
                                <select class="form-control mb-3" name="tipo_extra_costo">
                                    <option selected>-----</option>
                                    {% for tipo in ['AJUSTE TARIFA ADICIONAL POR TRAMO', 'AJUSTE TARIFA DESCUENTO POR TRAMO', 'CUADRATURA ARRIENDO FIJO', 'CUADRATURA ARRIENDO FIJO',
                                    'URGENCIA DOBLE CONDUCTOR', 'DIFERENCIA TARIFA EL LIBERTADOR', 'MOVIMIENTO INTERNO FAENA', 
                                    'REDESTINACION CLIENTE', 'REDESTINACION SITRANS', 'ESTADIA EN BODEGA DE CLIENTE', 'FALSO FLETE CLIENTE', 
                                    'FALSO FLETE OPERACIONAL SITRANS', 'POSICIONAMIENTO VACIO CLIENTE', 'POSICIONAMIENTO VACIO SITRANS', 'SIDER', 'SERVICIO SOBREDIMENSION'] %}
                                        <option value="{{ tipo }}" {% if d.tipo_extra_costo == tipo %} selected {% endif %}>{{ tipo }}</option>
                                    {% endfor %}
                                </select>                                        

                                <label>Motivo</label>
                                <input type="text" class="form-control mb-3" name="motivo" value="{{d.motivo}}">
                                
                                <label>Hora Llegada</label>
                                <input type="text" class="form-control mb-3" name="hora_llevada" value="{{d.hora_llegada}}" pattern="^(0[0-9]|1[0-9]|2[0-3]):[0-5][0-9]:[0-5][0-9]$" title="Por favor, ingrese una hora válida en formato hh:mm:ss">

                                <label>Dia</label>
                                <input type="text" class="form-control mb-3" name="dia2" value="{{d.dia2}}" pattern="\d{2}-\d{2}-\d{4}" title="Ingrese una fecha válida en formato dd-mm-yyyy">

                                <label>Hora de Salida</label>
                                <input type="text" class="form-control mb-3" name="hora_salida" value="{{d.hora_salida}}" pattern="^(0[0-9]|1[0-9]|2[0-3]):[0-5][0-9]:[0-5][0-9]$" title="Por favor, ingrese una hora válida en formato hh:mm:ss">

                                <label>Dia</label>
                                <input type="text" class="form-control mb-3" name="dia3" value="{{d.dia3}}" pattern="\d{2}-\d{2}-\d{4}" title="Ingrese una fecha válida en formato dd-mm-yyyy">

                                <label>Total Horas</label>
                                <input type="text" class="form-control mb-3" name="total_horas" value="{{d.total_horas}}">   

                                <label>Empresa</label>
                                <input type="text" class="form-control mb-3" name="empresa" value="{{d.empresa}}">    

                                <label>Responsable</label>
                                <select class="form-control mb-3" name="responsable">
                                    <option selected>-----</option>
                                    {% for resp in ['Cliente', 'Mintral'] %}
                                        <option value="{{ resp }}" {% if d.responsable == resp %} selected {% endif %}>{{ resp }}</option>
                                    {% endfor %}
                                </select>


                                <label>Monto</label>
                                <input type="text" class="form-control mb-3" name="monto" value="{{d.monto}}">  

                                <label>Estado</label>
                                <select class="form-control mb-3" name="estado">                                                  
                                    {% if dataLogin.tipoLogin != 100 %} 
                                        {% for estado in ['Ingreso AD. Contrato', 'Aprobado', 'Rechazado', 'Ingreso CAT'] %}
                                            <option value="{{ estado }}" {% if d.estado == estado %} selected {% endif %}>{{ estado }}</option>
                                        {% endfor %}
                                    {% elif dataLogin.tipoLogin == 100 %}
                                        <option value="Ingreso CAT" {% if d.estado == 'Ingreso CAT' %} selected {% endif %}>Ingreso CAT</option>
                                    {% endif %}                 
                                </select>


                                               
                        </div>
                        <div class="modal-footer">
                          <button type="submit" class="btn btn-primary">Save changes</button>
                        </div>
                        </form>
                      </div>
                    </div>
                  </div>

            {% endfor %}

        </tbody>

    </table>


    </div>
</div>
</div>
</div>

{% endblock %}